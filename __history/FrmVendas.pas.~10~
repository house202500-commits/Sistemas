unit FrmVendas;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Data.DB, Vcl.StdCtrls,
  Vcl.Grids, Vcl.DBGrids, Vcl.Buttons, dxGDIPlusClasses, Vcl.ComCtrls,FrmAdicConf,
  System.Actions, Vcl.ActnList, System.ImageList, Vcl.ImgList,FrmConsult,conexao,FrmCompTela,
    FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS,
  FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt,
  FireDAC.Comp.DataSet,
  FireDAC.Comp.Client;

type
  TFrmVenda = class(TForm)
    Panel1: TPanel;
    Label13: TLabel;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Edit3: TEdit;
    Image1: TImage;
    Panel2: TPanel;
    btnAdic: TSpeedButton;
    DBGrid1: TDBGrid;
    LbValorTl: TLabel;
    Label8: TLabel;
    Panel3: TPanel;
    Label9: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    Label14: TLabel;
    Label10: TLabel;
    Panel4: TPanel;
    RdioCredito: TRadioButton;
    RdioDinheiro: TRadioButton;
    RdioBoleto: TRadioButton;
    Panel5: TPanel;
    Panel6: TPanel;
    btnRemov: TSpeedButton;
    Panel7: TPanel;
    btnEdit: TSpeedButton;
    Panel8: TPanel;
    Panel9: TPanel;
    btnImprimir: TSpeedButton;
    Panel10: TPanel;
    Panel11: TPanel;
    btnFechar: TSpeedButton;
    btnCanc: TSpeedButton;
    btnSalvVen: TSpeedButton;
    LisBox: TListBox;
    LbEnd: TLabel;
    LbCid: TLabel;
    Button1: TButton;
    procedure btnAdicClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnAdicMouseEnter(Sender: TObject);
    procedure btnAdicMouseLeave(Sender: TObject);
    procedure btnRemovMouseEnter(Sender: TObject);
    procedure btnRemovMouseLeave(Sender: TObject);
    procedure btnEditMouseEnter(Sender: TObject);
    procedure btnEditMouseLeave(Sender: TObject);
    procedure btnSalvVenMouseEnter(Sender: TObject);
    procedure btnImprimirMouseEnter(Sender: TObject);
    procedure btnCancMouseEnter(Sender: TObject);
    procedure btnFecharMouseEnter(Sender: TObject);
    procedure btnSalvVenMouseLeave(Sender: TObject);
    procedure btnImprimirMouseLeave(Sender: TObject);
    procedure btnCancMouseLeave(Sender: TObject);
    procedure btnFecharMouseLeave(Sender: TObject);
    procedure btnFecharClick(Sender: TObject);
    procedure Image1Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure btnEditClick(Sender: TObject);
    procedure DBGrid1CellClick(Column: TColumn);

    procedure CarregarCliente(IDCliente: Integer);
    procedure AtualizaDgridProd;
    procedure Button1Click(Sender: TObject);


  private
    { Private declarations }
     FIDClienteAtual: Integer;
     FIDProdutoAtual: Integer;
  public
    { Public declarations }
  end;

var
  FrmVenda: TFrmVenda;

implementation

{$R *.dfm}


procedure TFrmVenda.AtualizaDgridProd;
begin
  FrmTelaCompras.LbNumCompr.Caption := FrmAdicionar.mtItens.FieldByName('CODIGO').AsString;
  FrmTelaCompras.LbDesProdC.Caption := FrmAdicionar.mtItens.FieldByName('DESCRICAO').AsString;
  FrmTelaCompras.LbVUnitC.Caption   := FormatFloat('0.00', FrmAdicionar.mtItens.FieldByName('VALOR_UNIT').AsFloat);
  FrmTelaCompras.LbDescontC.Caption := FormatFloat('0.00', FrmAdicionar.mtItens.FieldByName('DESCONTO').AsFloat) + '%';
  FrmTelaCompras.LbVlorItemC.Caption:= FormatFloat('0.00', FrmAdicionar.mtItens.FieldByName('TOTAL_ITEM').AsFloat);
  FrmTelaCompras.CbQuatEditar.Text  := FrmAdicionar.mtItens.FieldByName('QUANTIDADE').AsString;

  FrmTelaCompras.LbCliente.Caption:= Edit3.Text;

  FrmTelaCompras.ShowModal;
end;


procedure TFrmVenda.btnAdicClick(Sender: TObject);
begin
  FrmAdicionar.visible := not FrmAdicionar.visible;

end;

procedure TFrmVenda.btnAdicMouseEnter(Sender: TObject);
begin
    btnAdic.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnAdicMouseLeave(Sender: TObject);
begin
    btnAdic.Font.Color := clWhite;
end;

procedure TFrmVenda.btnCancMouseEnter(Sender: TObject);
begin
   btnCanc.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnCancMouseLeave(Sender: TObject);
begin
   btnCanc.Font.Color := clWhite;
end;

procedure TFrmVenda.btnEditClick(Sender: TObject);
begin
AtualizaDgridProd;
end;

procedure TFrmVenda.btnEditMouseEnter(Sender: TObject);
begin
    btnEdit.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnEditMouseLeave(Sender: TObject);
begin
   btnEdit.Font.Color := clWhite;
end;

procedure TFrmVenda.btnFecharClick(Sender: TObject);
begin
   close;
end;

procedure TFrmVenda.btnFecharMouseEnter(Sender: TObject);
begin
   btnFechar.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnFecharMouseLeave(Sender: TObject);
begin
   btnFechar.Font.Color := clWhite;
end;

procedure TFrmVenda.btnImprimirMouseEnter(Sender: TObject);
begin
   btnImprimir.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnImprimirMouseLeave(Sender: TObject);
begin
   btnImprimir.Font.Color := clWhite;
end;


procedure TFrmVenda.btnRemovMouseEnter(Sender: TObject);
begin
  btnRemov.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnRemovMouseLeave(Sender: TObject);
begin
   btnRemov.Font.Color := clWhite;
end;

procedure TFrmVenda.btnSalvVenMouseEnter(Sender: TObject);
begin
    btnSalvVen.Font.Color := $00908E4C;
end;

procedure TFrmVenda.btnSalvVenMouseLeave(Sender: TObject);
begin
   btnSalvVen.Font.Color := clWhite;
end;



procedure TFrmVenda.Button1Click(Sender: TObject);
begin
AtualizaDgridProd;
FrmTelaCompras.Show;
end;

procedure TFrmVenda.CarregarCliente(IDCliente: Integer);
var
  Qry: TFDQuery;
begin
  if IDCliente <= 0 then exit;

  Qry := TFDQuery.Create(nil);
  try
    Qry.Connection := Dm.Fconexao;
    Qry.SQL.Text := 'SELECT * FROM CLIENTES WHERE ID_CLIENTE = :ID AND STATUS = ''A''';
    Qry.ParamByName('ID').AsInteger := IDCliente;
    Qry.Open;



    if not Qry.IsEmpty then
    begin
    //  FIDClienteAtual := IDCliente;
    //  FModoEdicao := True;
     // HabilitarControles(True);
    {
      // Carregar dados
      if Qry.FieldByName('TIPO_PESSOA').AsString = 'F' then
      begin
        RadioButton1.Checked := True;
        RadioButton2.Checked := False;
      end
      else
      begin
        RadioButton1.Checked := False;
        RadioButton2.Checked := True;
      end;
    }

      FrmTelaCompras.Edit1.text := Qry.FieldByName('NOME_COMPLETO').AsString;

      FrmTelaCompras.Edit2.text := IntToStr(FIDClienteAtual);

      ShowMessage('✅ Cliente carregado para edição!');
    end
    else
    begin
      ShowMessage('❌ Cliente não encontrado ou inativo!');
    end;

  finally
    Qry.Free;
  end;
end;

procedure TFrmVenda.DBGrid1CellClick(Column: TColumn);
begin
AtualizaDgridProd;
end;


procedure TFrmVenda.FormCreate(Sender: TObject);
begin
   Label10.Caption := FormatDateTime('dd/MM/yyyy', Now);

end;

procedure TFrmVenda.FormShow(Sender: TObject);
VAR
i: Integer;
begin
    DBGrid1.Columns[0].Title.Caption := 'CÓDIGO';
    DBGrid1.Columns[1].Title.Alignment := taCenter;


// procedure TFrmVenda.FormCreate(Sender: TObject);
//var
 // i: Integer;
begin
  for i := 0 to DBGrid1.Columns.Count - 1 do
  begin
    // CÓDIGO
    if DBGrid1.Columns[i].FieldName = 'CODIGO' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'CÓDIGO';
      DBGrid1.Columns[i].Alignment := taLeftJustify;
      DBGrid1.Columns[i].Title.Alignment := taLeftJustify;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 70;
    end;

    // DESCRIÇÃO
    if DBGrid1.Columns[i].FieldName = 'DESCRICAO' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'DESCRIÇÃO';
      DBGrid1.Columns[i].Alignment := taLeftJustify;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 420;
    end;

    // QUANTIDADE
    if DBGrid1.Columns[i].FieldName = 'QUANTIDADE' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'QTD';
      DBGrid1.Columns[i].Alignment := taCenter;
      DBGrid1.Columns[i].Title.Alignment := taCenter;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 60;
    end;

    // VALOR UNITÁRIO
    if DBGrid1.Columns[i].FieldName = 'VALOR_UNIT' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'VLR UNIT';
      DBGrid1.Columns[i].Alignment := taRightJustify;
      DBGrid1.Columns[i].Title.Alignment := taRightJustify;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 90;
    end;

    // DESCONTO
    if DBGrid1.Columns[i].FieldName = 'DESCONTO' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'DESC %';
      DBGrid1.Columns[i].Alignment := taRightJustify;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 70;
    end;

    // TOTAL
    if DBGrid1.Columns[i].FieldName = 'TOTAL_ITEM' then
    begin
      DBGrid1.Columns[i].Title.Caption := 'TOTAL';
      DBGrid1.Columns[i].Alignment := taRightJustify;
      DBGrid1.Columns[i].Title.Alignment := taRightJustify;
      DBGrid1.Columns[i].Title.Font.Style := [fsBold];
      DBGrid1.Columns[i].Width := 100;
    end;

  end;
end;





end;

procedure TFrmVenda.Image1Click(Sender: TObject);
begin
  FrmConsulta.show;
end;

end.



